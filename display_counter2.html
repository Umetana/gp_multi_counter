<!-- GPマルチカウンター v1.1.0 対応版 (OBSローカルファイル最適化済) -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>GP MULTI COUNTER - Display</title>
    <style>
        body {
            background-color: transparent;
            margin: 0;
            padding: 10px;
            overflow: hidden;
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            color: #ffffff;
        }

        .counter-box {
            border: 3px solid #ffffff;
            border-radius: 8px;
            padding: 15px 25px;
            background-color: rgba(0, 0, 0, 0.5);
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
        }

        .label {
            font-size: 20px;
            margin-bottom: 5px;
            white-space: nowrap;
        }

        .count-container {
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 5px;
        }

        .count {
            font-size: 48px;
            line-height: 1.2;
        }

        .unit {
            font-size: 0.5em;
            margin-left: 2px;
        }

        .goal-display {
            font-size: 0.6em;
            opacity: 0.8;
            margin-left: 8px;
        }
    </style>
</head>
<body>

    <div id="counterBox" class="counter-box">
        <div id="labelText" class="label">読み込み中...</div>
        <div class="count-container">
            <div id="countValue" class="count">
                0
                <span id="goalText" class="goal-display"></span>
            </div>
            <div id="unitText" class="unit"></div>
        </div>
    </div>

    <script>
        /**
         * カウンターIDの判定ロジック
         * 1. URLパラメータ (?id=counter1) をチェック
         * 2. なければファイル名 (display_counter2.html -> counter2) をチェック
         * 3. それもなければデフォルト (counter1)
         */
        function getMyId() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('id')) return params.get('id');

            const fileName = window.location.pathname.split('/').pop();
            const match = fileName.match(/counter(\d+)/i);
            return match ? 'counter' + match[1] : 'counter1';
        }

        const MY_COUNTER_ID = getMyId();
        const channel = new BroadcastChannel('obs_counter_sync');

        function updateUI(data) {
            if (!data || data.id !== MY_COUNTER_ID) return;

            const box = document.getElementById("counterBox");
            const countEl = document.getElementById("countValue");
            const labelEl = document.getElementById("labelText");
            const unitEl = document.getElementById("unitText");
            const goalEl = document.getElementById("goalText");

            countEl.childNodes[0].textContent = data.count;
            unitEl.textContent = data.unit || "";
            labelEl.textContent = data.label;

            box.style.backgroundColor = data.bgColor;
            box.style.borderColor = data.borderColor;
            box.style.fontFamily = data.fontFamily || 'sans-serif';
            
            labelEl.style.fontSize = data.labelSize.includes('px') ? data.labelSize : data.labelSize + "px";
            countEl.style.fontSize = data.countSize.includes('px') ? data.countSize : data.countSize + "px";

            countEl.style.fontWeight = data.isBold ? 'bold' : 'normal';
            const shadowStyle = data.isShadow ? '2px 2px 4px rgba(0,0,0,0.8)' : 'none';
            labelEl.style.textShadow = shadowStyle;
            countEl.style.textShadow = shadowStyle;
            unitEl.style.textShadow = shadowStyle;

            if (data.showGoal) {
                goalEl.textContent = ` / ${data.goalCount}`;
                goalEl.style.display = "inline";
                if (parseInt(data.count) >= parseInt(data.goalCount)) {
                    countEl.style.color = "#ffeb3b";
                } else {
                    countEl.style.color = data.textColor;
                }
            } else {
                goalEl.style.display = "none";
                countEl.style.color = data.textColor;
            }
            document.body.style.color = data.textColor;
        }

        function init() {
            const saved = localStorage.getItem("allCountersSettings");
            if (saved) {
                try {
                    const allData = JSON.parse(saved);
                    const myData = allData.find(c => c.id === MY_COUNTER_ID);
                    if (myData) updateUI(myData);
                } catch(e) { console.error(e); }
            }
        }

        channel.onmessage = (e) => {
            if (e.data.type === 'update') {
                const myData = e.data.payload.find(c => c.id === MY_COUNTER_ID);
                if (myData) updateUI(myData);
            }
        };

        init();
    </script>
</body>
</html>